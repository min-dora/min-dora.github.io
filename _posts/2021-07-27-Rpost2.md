---
date: 2021-07-27
title: "[R] 선 그래프 만들기(line plot) by.[2020 빅데이터 분석 및 아이디어 공모전]"
categories: R
tags: 
- R

toc: true  
toc_sticky: true 
sidebar_main: true
author_profile: true
---
<br>
<br>

이번 포스팅에서는 선 그래프(line plot)에 대해서 알아보겠습니다.<br>
선 그래프는 일상생활에서도 주식, 기상, 인구 수 등
주로 연도나 시간의 흐름에 따라 변화를 표현할 때 자주 쓰입니다.  


R에서 `ggplot`, `ployly` 등 다양한 패키지를 이용해서 그릴 수 있지만, 이번 시간에는 기본 함수로 그려보도록 하겠습니다.  


* 보건/복지를 주제로 데이터 분석/아이디어 공모전에 참가했던 내용을 토대로 작성했습니다. <br>
처음으로 진행했던 공모전으로 다소 부족한 점이 많으니 양해 부탁드립니다. 😄<br>
전처리 과정을 스킵하고 그래프 그리는 부분을 보시고 싶다면 우측에 **시각화**를 클릭하시면 되겠습니다.




## Index
1. `전 연령` 유동인구 `상위 3개 동네` 시간대 별 유동인구합계 그래프
2. 전 연령 유동인구 `하위 3개 동네` 시간대 별 유동인구합계 그래프
3. `6~70대` 유동인구 `상위 3개 동네` 시간대 별 유동인구합계 그래프
4. 6~70대 유동인구 `하위 3개 동네` 시간대 별 유동인구합계 그래프

## 패키지 설치 및 파일 불러오기
```yaml
install.packages("readxl")
install.packages("dplyr")
library(readxl)
library(dplyr)
df <- read_excel(file.choose(),sheet = "sheet1")
```

사용한 데이터로는 대전광역시의 행정동, 월, 시간, 남녀, 연령(10세 단위)별 유동인구 데이터입니다. <br>
~~(보안상의 이유로 데이터 공개는 어렵습니다..!)~~

Excel파일을 불러오기위해(.xlsx) `readxl` 패키지를 설치 및 불러온 후, `read_excel()`을 이용하여 원본 데이터의 `sheet1`을 가져 왔습니다.<br>

![원본데이터_head](/assets/images/Rpost2_1.PNG)

## 전처리

### 변수명 변경
데이터의 변수명을 좀 더 간단하게 하기위해서 아래와 같이 변경하였습니다.
> * 남자 10대 미만 -> m0, 남자 10대 -> m1, ... 남자 70대 이상 -> m7
> * 여자 10대 미만 -> f0, 여자 10대 -> f1, ... 여자 70대 이상 -> f7 <br>

```markdown
df2003 <- rename(df, m0 = `남10대 미만`, m1 = 남10대, m2 = 남20대, m3 = 남30대, m4 = 남40대, m5 = 남50대, m6 = 남60대, m7 = `남70대 이상`)
df2003 <- rename(df2003, f0 = `여10대 미만`, f1 = 여10대, f2 = 여20대, f3 = 여30대, f4 = 여40대, f5 = 여50대, f6 = 여60대, f7 = `여70대 이상`)
names(df2003)
```
<br>

* 코드 실행 결과
```markdown
> names(df2003)
 [1] "연월"   "시"     "구"     "행정동" "시간대" "m0"     "m1"     "m2"     "m3"     "m4"     "m5"     "m6"     "m7"     "f0"     "f1"     "f2"     "f3"     "f4"     "f5"     "f6"     "f7" 
```

### 결측치 처리
유동인구 수 column 중에서 일부 연령층에서 야간에 이동한 인구가 없는 경우가 있습니다.<br>
이를 데이터 상에서 값을 `-` 혹은 `NA`로 처리 해놓았습니다. 그리하여 숫자형으로 변환을 시켜서 전부 `NA`으로 만든 뒤 그래프를 그리기 위해 해당 결측치를 숫자 0으로 바꿔 주었습니다.

```markdown
df2003$m0 <- as.numeric(df2003$m0)
df2003$m7 <- as.numeric(df2003$m7)
df2003$f0 <- as.numeric(df2003$f0)
df2003$f1 <- as.numeric(df2003$f1)
df2003$f3 <- as.numeric(df2003$f3)
df2003$f4 <- as.numeric(df2003$f4)
df2003$f6 <- as.numeric(df2003$f6)
df2003$f7 <- as.numeric(df2003$f7)
str(df2003)

df2003[is.na(df2003)] <- 0 # NA로 표기 된 값을 0으로 변경.

sum(is.na(df2003)) # 데이터 셋에서 na값 갯수의 합을 출력.
```

* 코드 실행 결과
```markdown
> str(df2003)
tibble [28,440 x 21] (S3: tbl_df/tbl/data.frame)
 $ 연월  : num [1:28440] 201901 201901 201901 201901 201901 ...
 $ 시    : chr [1:28440] "대전광역시" "대전광역시" "대전광역시" "대전광역시" ...
 $ 구    : chr [1:28440] "동구" "동구" "동구" "동구" ...
 $ 행정동: chr [1:28440] "중앙동" "중앙동" "중앙동" "중앙동" ...
 $ 시간대: num [1:28440] 0 1 2 3 4 5 6 7 8 9 ...
 $ m0    : num [1:28440] 138 140 129 117 123 126 115 225 231 246 ...
 $ m1    : num [1:28440] 2518 1786 1195 915 942 ...
 $ m2    : num [1:28440] 18576 11463 7579 5826 4867 ...
 $ m3    : num [1:28440] 13751 7785 5499 4234 4088 ...
 $ m4    : num [1:28440] 16533 8670 5567 4741 5934 ...
 $ m5    : num [1:28440] 26904 13615 7951 6482 7366 ...
 $ m6    : num [1:28440] 22268 10848 6307 5243 6633 ...
 $ m7    : num [1:28440] 3532 1387 916 908 1332 ...
 $ f0    : num [1:28440] 41 37 25 21 22 30 39 62 143 188 ...
 $ f1    : num [1:28440] 1789 783 555 436 443 ...
 $ f2    : num [1:28440] 11443 5409 3044 2250 1936 ...
 $ f3    : num [1:28440] 6761 3611 2421 1870 1709 ...
 $ f4    : num [1:28440] 5113 2838 1926 1574 1605 ...
 $ f5    : num [1:28440] 7125 4122 2578 2041 2484 ...
 $ f6    : num [1:28440] 2815 1850 1375 1292 2163 ...
 $ f7    : num [1:28440] 1052 658 384 415 496 ...

> df2003[is.na(df2003)] <- 0

> sum(is.na(df2003))
[1] 0
```